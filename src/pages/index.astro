---
import Layout from '../layouts/Layout.astro'
import GameCard from '../components/GameCard.astro'

const featuredGames = [
  {
    id: 'game01',
    titleKey: 'home.featuredGame.title',
    descriptionKey: 'home.featuredGame.description',
    tagsKeys: ['games.tags.adventure', 'games.tags.puzzle'],
    image: '/images/game/game01/cover.png',
  },
  {
    id: 'game02',
    titleKey: 'home.featuredGame.title',
    descriptionKey: 'home.featuredGame.description',
    tagsKeys: ['games.tags.adventure'],
    image: '/images/game02/cover.png',
  },
  {
    id: 'game03',
    titleKey: 'common.comingSoon',
    descriptionKey: 'common.comingSoon',
    tagsKeys: [],
    image: '/images/game03/cover.png',
  },
]

const otherGames = [
  {
    id: 'game02',
    title: '遊戲作品 2',
    description: '即將推出',
    image: '/images/game02_cover.jpg',
  },
  {
    id: 'game03',
    title: '遊戲作品 3',
    description: '即將推出',
    image: '/images/game03_cover.jpg',
  },
  {
    id: 'game04',
    title: '遊戲作品 4',
    description: '即將推出',
    image: '/images/game04_cover.jpg',
  },
]
---

<Layout title="花火風船">
  <!-- Hero Section - 大型特色遊戲區域 -->
  <section class="pt-36 pb-8">
    <!-- 16:9 遊戲封面輪播 -->
    <div class="relative max-w-4xl mx-auto">
      <!-- 輪播容器 -->
      <div class="relative aspect-video rounded-xl overflow-hidden" style="box-shadow: 0 -1px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 6px -1px rgb(0 0 0 / 0.4);">
        {featuredGames.map((game, index) => (
          <div 
            class:list={[
              "carousel-item absolute inset-0 transition-opacity duration-500",
              index === 0 ? "opacity-100 z-10" : "opacity-0 z-0"
            ]}
            data-index={index}
          >
            <a href={`/games/${game.id}`} class="block h-full group">
              <!-- 背景圖片 -->
              <div class="absolute inset-0">
                <img 
                  src={game.image}
                  alt={game.titleKey}
                  class="w-full h-full object-cover"
                />
                <!-- 漸層遮罩 - 讓文字更清晰 -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent" />
              </div>

              <!-- 遊戲資訊內容 -->
              <div class="relative h-full flex items-end">
                <div class="w-full max-w-4xl mx-auto px-6 pb-32">
                  <!-- 標籤 -->
                  <div class="flex gap-3 mb-6">
                    {game.tagsKeys.map((tagKey) => (
                      <span class="px-4 py-2 text-sm font-semibold bg-pink-500/30 text-pink-300 rounded-lg backdrop-blur-md border border-pink-400/30" data-i18n={tagKey}>
                      </span>
                    ))}
                  </div>

                  <!-- 遊戲標題 -->
                  <h1 class="text-5xl md:text-7xl font-black text-white mb-4 leading-tight drop-shadow-2xl" data-i18n={game.titleKey}>
                  </h1>

                  <!-- 遊戲描述 -->
                  <p class="text-xl text-gray-200 mb-8 max-w-2xl drop-shadow-lg" data-i18n={game.descriptionKey}>
                  </p>

                  <!-- 查看按鈕 -->
                  <span class="inline-flex items-center gap-3 px-8 py-4 bg-pink-500 hover:bg-pink-600 text-white font-bold text-lg rounded-xl transition-all shadow-xl hover:shadow-2xl hover:scale-105">
                    <span data-i18n="home.featuredGame.playNow"></span>
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </span>
                </div>
              </div>
            </a>
          </div>
        ))}

        <!-- 左右切換按鈕 -->
        <button 
          id="carousel-prev"
          class="absolute left-4 top-1/2 -translate-y-1/2 z-20 bg-white/20 hover:bg-white/30 text-white p-3 rounded-full backdrop-blur-md transition-all"
          aria-label="上一個"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <button 
          id="carousel-next"
          class="absolute right-4 top-1/2 -translate-y-1/2 z-20 bg-white/20 hover:bg-white/30 text-white p-3 rounded-full backdrop-blur-md transition-all"
          aria-label="下一個"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>

      <!-- Dot Navigation -->
      <div class="flex justify-center gap-2 mt-6">
        {featuredGames.map((_, index) => (
          <button
            class:list={[
              "carousel-dot w-3 h-3 rounded-full transition-all",
              index === 0 ? "bg-pink-500 w-8" : "bg-gray-400 hover:bg-gray-500"
            ]}
            data-index={index}
            aria-label={`前往遊戲 ${index + 1}`}
          >
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- 其他遊戲區域 -->
  <section class="py-16">
    <div class="max-w-4xl mx-auto px-6">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-12" data-i18n="home.moreGames">
      </h2>
      
      <!-- 遊戲卡片網格 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {otherGames.map((game) => (
          <GameCard 
            title={game.title}
            description={game.description}
            image={game.image}
            href={`/games/${game.id}`}
          />
        ))}
      </div>
    </div>
  </section>
</Layout>

<script>
  import { updateContent } from '../scripts/i18n'
  updateContent()

  // Carousel functionality
  let currentIndex = 0
  const carouselItems = document.querySelectorAll('.carousel-item')
  const carouselDots = document.querySelectorAll('.carousel-dot')
  const prevBtn = document.getElementById('carousel-prev')
  const nextBtn = document.getElementById('carousel-next')

  function showSlide(index: number) {
    // 隱藏所有 slides
    carouselItems.forEach((item, i) => {
      if (i === index) {
        item.classList.remove('opacity-0', 'z-0')
        item.classList.add('opacity-100', 'z-10')
      } else {
        item.classList.remove('opacity-100', 'z-10')
        item.classList.add('opacity-0', 'z-0')
      }
    })

    // 更新 dots
    carouselDots.forEach((dot, i) => {
      if (i === index) {
        dot.classList.remove('bg-gray-400', 'w-3')
        dot.classList.add('bg-pink-500', 'w-8')
      } else {
        dot.classList.remove('bg-pink-500', 'w-8')
        dot.classList.add('bg-gray-400', 'w-3')
      }
    })

    currentIndex = index
  }

  // 上一個按鈕
  prevBtn?.addEventListener('click', () => {
    const newIndex = currentIndex === 0 ? carouselItems.length - 1 : currentIndex - 1
    showSlide(newIndex)
  })

  // 下一個按鈕
  nextBtn?.addEventListener('click', () => {
    const newIndex = currentIndex === carouselItems.length - 1 ? 0 : currentIndex + 1
    showSlide(newIndex)
  })

  // Dot 點擊
  carouselDots.forEach((dot) => {
    dot.addEventListener('click', () => {
      const index = parseInt(dot.getAttribute('data-index') || '0')
      showSlide(index)
    })
  })

  // 自動輪播（可選）
  // setInterval(() => {
  //   const newIndex = currentIndex === carouselItems.length - 1 ? 0 : currentIndex + 1
  //   showSlide(newIndex)
  // }, 5000)
</script>
